import "./paths-CyR9Pa1R.js";
import { t as createSubsystemLogger } from "./subsystem-NZzGD1xL.js";
import { c as resolveDefaultAgentId, r as resolveAgentDir, s as resolveAgentWorkspaceDir } from "./agent-scope-DGv_lb5V.js";
import "./workspace-DSaPuILJ.js";
import "./tokens-D_6bHP0d.js";
import { t as runEmbeddedPiAgent } from "./pi-embedded-b5EhLFgE.js";
import "./plugins-DRxcIsdW.js";
import "./accounts-BdsaOk1K.js";
import "./boolean-mcn6kL0s.js";
import "./command-format-DkQnibeb.js";
import "./bindings-BAjLQTjN.js";
import "./send-Ds-2XF5y.js";
import "./send-B5wXuvAU.js";
import "./deliver-CH3Y5bRD.js";
import "./diagnostic-KeVQjolu.js";
import "./diagnostic-session-state-Bxo4UHOL.js";
import "./accounts-Bnm1qsMy.js";
import "./send-DJHamGpM.js";
import "./image-ops-D_0HqKCn.js";
import "./model-auth-D7yExN0T.js";
import "./github-copilot-token-Dgb9dAHW.js";
import "./pi-model-discovery-DaNAekda.js";
import "./message-channel-CGfDQO-K.js";
import "./pi-embedded-helpers-DxTyisc4.js";
import "./config-Co-5D6Gn.js";
import "./manifest-registry-CBHbnE_M.js";
import "./dock-EZ2jebb_.js";
import "./chrome-B1nMBMAN.js";
import "./ssrf-DoQDLHSj.js";
import "./frontmatter-CGOZnTsi.js";
import "./skills-CfaId93d.js";
import "./redact-CpDh05JC.js";
import "./errors-xxnHvoWf.js";
import "./store-LAmaIatB.js";
import "./sessions-The2KDBw.js";
import "./accounts-CU1yRDCa.js";
import "./paths-DZd1zVsd.js";
import "./tool-images-Dq_CJUOG.js";
import "./thinking-Ds6fxj9u.js";
import "./image-Cl4RgYGS.js";
import "./reply-prefix-CcHHKxqr.js";
import "./manager-CzYqmNNc.js";
import "./gemini-auth-BkfXMw6M.js";
import "./fetch-guard-BlZG4Lmu.js";
import "./query-expansion-CEv78HTf.js";
import "./retry-R2-ijxad.js";
import "./target-errors-BCxkxt23.js";
import "./chunk-BfP6KnSJ.js";
import "./markdown-tables-D2nzL-yS.js";
import "./local-roots-BpEzzsZA.js";
import "./ir-CVhLchLc.js";
import "./render-D7U4wOLO.js";
import "./commands-registry-B_RJj3YI.js";
import "./skill-commands-s4CyL99S.js";
import "./runner-CjFAR0P3.js";
import "./fetch-xJrgyxIC.js";
import "./channel-activity-CeK8ljUk.js";
import "./tables-EWdJXa91.js";
import "./send-OrSUUlSK.js";
import "./outbound-attachment-Cb2EusK2.js";
import "./send-D9xANWuj.js";
import "./resolve-route-C9fIfNqd.js";
import "./proxy-DTBHP1Tj.js";
import "./replies-DS7HJuGD.js";
import fs from "node:fs/promises";
import os from "node:os";
import path from "node:path";

//#region src/hooks/llm-slug-generator.ts
/**
* LLM-based slug generator for session memory filenames
*/
const log = createSubsystemLogger("llm-slug-generator");
/**
* Generate a short 1-2 word filename slug from session content using LLM
*/
async function generateSlugViaLLM(params) {
	let tempSessionFile = null;
	try {
		const agentId = resolveDefaultAgentId(params.cfg);
		const workspaceDir = resolveAgentWorkspaceDir(params.cfg, agentId);
		const agentDir = resolveAgentDir(params.cfg, agentId);
		const tempDir = await fs.mkdtemp(path.join(os.tmpdir(), "openclaw-slug-"));
		tempSessionFile = path.join(tempDir, "session.jsonl");
		const prompt = `Based on this conversation, generate a short 1-2 word filename slug (lowercase, hyphen-separated, no file extension).

Conversation summary:
${params.sessionContent.slice(0, 2e3)}

Reply with ONLY the slug, nothing else. Examples: "vendor-pitch", "api-design", "bug-fix"`;
		const result = await runEmbeddedPiAgent({
			sessionId: `slug-generator-${Date.now()}`,
			sessionKey: "temp:slug-generator",
			agentId,
			sessionFile: tempSessionFile,
			workspaceDir,
			agentDir,
			config: params.cfg,
			prompt,
			timeoutMs: 15e3,
			runId: `slug-gen-${Date.now()}`
		});
		if (result.payloads && result.payloads.length > 0) {
			const text = result.payloads[0]?.text;
			if (text) return text.trim().toLowerCase().replace(/[^a-z0-9-]/g, "-").replace(/-+/g, "-").replace(/^-|-$/g, "").slice(0, 30) || null;
		}
		return null;
	} catch (err) {
		const message = err instanceof Error ? err.stack ?? err.message : String(err);
		log.error(`Failed to generate slug: ${message}`);
		return null;
	} finally {
		if (tempSessionFile) try {
			await fs.rm(path.dirname(tempSessionFile), {
				recursive: true,
				force: true
			});
		} catch {}
	}
}

//#endregion
export { generateSlugViaLLM };