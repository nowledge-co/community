{"version":3,"file":"LongTimeout.js","sourceRoot":"","sources":["../src/LongTimeout.ts"],"names":[],"mappings":"AAAA,MAAM,eAAe,GAAG,UAAU,CAAC;AAEnC;;;;;;;;;;;;;;;;GAgBG;AACH,MAAM,OAAO,WAAW;IACpB,gBAAgB,CAAkB,SAAS,CAAa;IACxD,gBAAgB,CAAkB,UAAU,CAAS;IACrD,gBAAgB,CAAkB,MAAM,CAAS;IACjD,gBAAgB,CAAS,QAAQ,CAA4C;IAE7E,YAAmB,QAAoB,EAAE,KAAa;QAClD,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;QAC1B,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QAC7B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAE7C,IAAI,CAAC,QAAQ,GAAG,UAAU,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;IAC3G,CAAC;IAEM,OAAO;QACV,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI;YACrB,OAAO;QAEX,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC5B,IAAI,CAAC,QAAQ,GAAG,SAAS,CAAC;IAC9B,CAAC;IAEM,CAAC,MAAM,CAAC,OAAO,CAAC;QACnB,IAAI,CAAC,OAAO,EAAE,CAAC;IACnB,CAAC;IAED,IAAW,QAAQ;QACf,OAAO,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC;IACjC,CAAC;IAED,gBAAgB;IACR,UAAU;QACd,MAAM,WAAW,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QAC/B,MAAM,UAAU,GAAG,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC;QACjD,MAAM,QAAQ,GAAG,IAAI,CAAC,MAAM,GAAG,UAAU,CAAC;QAE1C,IAAI,QAAQ,IAAI,CAAC,EAAE,CAAC;YAChB,IAAI,CAAC,QAAQ,GAAG,SAAS,CAAC;YAC1B,IAAI,CAAC,SAAS,EAAE,CAAC;QACrB,CAAC;;YACG,IAAI,CAAC,QAAQ,GAAG,UAAU,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,eAAe,CAAC,CAAC,CAAC;IACzF,CAAC;CACJ;AAED;;;;;;;;;;;;;;;;;GAiBG;AACH,MAAM,UAAU,cAAc,CAAC,QAAoB,EAAE,KAAa;IAC9D,OAAO,IAAI,WAAW,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;AAC5C,CAAC;AAED;;;;;;;;;;;;;;;;;;;;GAoBG;AACH,MAAM,UAAU,gBAAgB,CAAC,OAAgF;IAC7G,IAAI,OAAO,IAAI,IAAI;QACf,OAAO;IAEX,IAAI,OAAO,YAAY,WAAW;QAC9B,OAAO,CAAC,OAAO,EAAE,CAAC;;QAElB,YAAY,CAAC,OAAO,CAAC,CAAC;AAC9B,CAAC","sourcesContent":["const maxTimeoutDelay = 2147483647;\n\n/**\n * A timeout that can be set to a delay longer than the maximum timeout delay supported by a regular `setTimeout`.\n *\n * For example,\n * ```typescript\n * import {LongTimeout} from \"lifecycle-utils\";\n *\n * const month = 1000 * 60 * 60 * 24 * 7 * 30;\n *\n * const timeout = new LongTimeout(() => {\n *     console.log(\"timeout\");\n * }, month);\n *\n * // to clear the timeout, call dispose\n * // timeout.dispose();\n * ```\n */\nexport class LongTimeout {\n    /** @internal */ private readonly _callback: () => void;\n    /** @internal */ private readonly _startTime: number;\n    /** @internal */ private readonly _delay: number;\n    /** @internal */ private _timeout: ReturnType<typeof setTimeout> | undefined;\n\n    public constructor(callback: () => void, delay: number) {\n        this._callback = callback;\n        this._delay = delay;\n        this._startTime = Date.now();\n        this._onTimeout = this._onTimeout.bind(this);\n\n        this._timeout = setTimeout(this._onTimeout, Math.floor(Math.max(0, Math.min(delay, maxTimeoutDelay))));\n    }\n\n    public dispose() {\n        if (this._timeout == null)\n            return;\n\n        clearTimeout(this._timeout);\n        this._timeout = undefined;\n    }\n\n    public [Symbol.dispose]() {\n        this.dispose();\n    }\n\n    public get disposed() {\n        return this._timeout == null;\n    }\n\n    /** @internal */\n    private _onTimeout() {\n        const currentTime = Date.now();\n        const timePassed = currentTime - this._startTime;\n        const timeLeft = this._delay - timePassed;\n\n        if (timeLeft <= 0) {\n            this._timeout = undefined;\n            this._callback();\n        } else\n            this._timeout = setTimeout(this._onTimeout, Math.min(timeLeft, maxTimeoutDelay));\n    }\n}\n\n/**\n * Sets a timeout that can also be set to a delay longer than the maximum timeout delay supported by a regular `setTimeout`.\n * You can use `clearLongTimeout` to clear the timeout.\n *\n * For example,\n * ```typescript\n * import {setLongTimeout, clearLongTimeout} from \"lifecycle-utils\";\n *\n * const month = 1000 * 60 * 60 * 24 * 7 * 30;\n *\n * const timeout = setLongTimeout(() => {\n *     console.log(\"timeout\");\n * }, month);\n *\n * // to clear the timeout, call clearLongTimeout\n * // clearLongTimeout(timeout);\n * ```\n */\nexport function setLongTimeout(callback: () => void, delay: number): LongTimeout {\n    return new LongTimeout(callback, delay);\n}\n\n/**\n * Clears a timeout that was set with `setLongTimeout`.\n * You can also clear a regular timeout with this function.\n *\n * For example,\n * ```typescript\n * import {setLongTimeout, clearLongTimeout} from \"lifecycle-utils\";\n *\n * const month = 1000 * 60 * 60 * 24 * 7 * 30;\n *\n * const timeout = setLongTimeout(() => {\n *     console.log(\"timeout\");\n * }, month);\n * const timeout2 = setTimeout(() => {\n *     console.log(\"timeout2\");\n * }, 1000 * 60);\n *\n * clearLongTimeout(timeout);\n * clearLongTimeout(timeout2);\n * ```\n */\nexport function clearLongTimeout(timeout: LongTimeout | number | undefined | null | ReturnType<typeof setTimeout>) {\n    if (timeout == null)\n        return;\n\n    if (timeout instanceof LongTimeout)\n        timeout.dispose();\n    else\n        clearTimeout(timeout);\n}\n"]}