{"version":3,"file":"AsyncDisposableHandle.js","sourceRoot":"","sources":["../src/AsyncDisposableHandle.ts"],"names":[],"mappings":"AAAA;;;;;GAKG;AACH,MAAM,OAAO,qBAAqB;IAC9B,gBAAgB,CAAS,UAAU,CAAoC;IACvE,gBAAgB,CAAS,eAAe,CAAiB;IAEzD,YAAmB,SAA8B;QAC7C,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;QAE5B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACvC,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACrE,CAAC;IAED,IAAW,QAAQ;QACf,OAAO,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC;IACnC,CAAC;IAEM,KAAK,CAAC,CAAC,MAAM,CAAC,YAAY,CAAC;QAC9B,MAAM,IAAI,CAAC,OAAO,EAAE,CAAC;IACzB,CAAC;IAEM,KAAK,CAAC,OAAO;QAChB,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,EAAE,CAAC;YAC1B,MAAM,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC;YAClC,OAAO,IAAI,CAAC,UAAU,CAAC;YAEvB,IAAI,CAAC,eAAe,GAAG,SAAS,EAAE,CAAC;YACnC,MAAM,IAAI,CAAC,eAAe,CAAC;QAC/B,CAAC;QAED,MAAM,IAAI,CAAC,eAAe,CAAC;IAC/B,CAAC;CACJ","sourcesContent":["/**\n * An object that provides an async `.dispose()` method that can called only once.\n *\n * Calling `.dispose()` will call the provided `onDispose` function only once.\n * Any subsequent calls to `.dispose()` will do nothing.\n */\nexport class AsyncDisposableHandle {\n    /** @internal */ private _onDispose: (() => Promise<void>) | undefined;\n    /** @internal */ private _disposePromise?: Promise<void>;\n\n    public constructor(onDispose: () => Promise<void>) {\n        this._onDispose = onDispose;\n\n        this.dispose = this.dispose.bind(this);\n        this[Symbol.asyncDispose] = this[Symbol.asyncDispose].bind(this);\n    }\n\n    public get disposed() {\n        return this._onDispose == null;\n    }\n\n    public async [Symbol.asyncDispose]() {\n        await this.dispose();\n    }\n\n    public async dispose() {\n        if (this._onDispose != null) {\n            const onDispose = this._onDispose;\n            delete this._onDispose;\n\n            this._disposePromise = onDispose();\n            await this._disposePromise;\n        }\n\n        await this._disposePromise;\n    }\n}\n"]}